<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CppServer: https_server.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CppServer
   &#160;<span id="projectnumber">1.0.4.0</span>
   </div>
   <div id="projectbrief">C++ Server Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">https_server.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>HTTPS server example</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;asio_service.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="https__server_8h.html">server/http/https_server.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;string/string_utils.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;utility/singleton.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Cache : <span class="keyword">public</span> CppCommon::Singleton&lt;Cache&gt;</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">friend</span> CppCommon::Singleton&lt;Cache&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    std::string GetAllCache()</div>
<div class="line">    {</div>
<div class="line">        std::scoped_lock locker(_cache_lock);</div>
<div class="line">        std::string result;</div>
<div class="line">        result += <span class="stringliteral">&quot;[\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; item : _cache)</div>
<div class="line">        {</div>
<div class="line">            result += <span class="stringliteral">&quot;  {\n&quot;</span>;</div>
<div class="line">            result += <span class="stringliteral">&quot;    \&quot;key\&quot;: \&quot;&quot;</span> + item.first + <span class="stringliteral">&quot;\&quot;,\n&quot;</span>;</div>
<div class="line">            result += <span class="stringliteral">&quot;    \&quot;value\&quot;: \&quot;&quot;</span> + item.second + <span class="stringliteral">&quot;\&quot;,\n&quot;</span>;</div>
<div class="line">            result += <span class="stringliteral">&quot;  },\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        result += <span class="stringliteral">&quot;]\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> GetCacheValue(std::string_view key, std::string&amp; value)</div>
<div class="line">    {</div>
<div class="line">        std::scoped_lock locker(_cache_lock);</div>
<div class="line">        <span class="keyword">auto</span> it = _cache.find(key);</div>
<div class="line">        <span class="keywordflow">if</span> (it != _cache.end())</div>
<div class="line">        {</div>
<div class="line">            value = it-&gt;second;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> PutCacheValue(std::string_view key, std::string_view value)</div>
<div class="line">    {</div>
<div class="line">        std::scoped_lock locker(_cache_lock);</div>
<div class="line">        <span class="keyword">auto</span> it = _cache.emplace(key, value);</div>
<div class="line">        <span class="keywordflow">if</span> (!it.second)</div>
<div class="line">            it.first-&gt;second = value;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> DeleteCacheValue(std::string_view key, std::string&amp; value)</div>
<div class="line">    {</div>
<div class="line">        std::scoped_lock locker(_cache_lock);</div>
<div class="line">        <span class="keyword">auto</span> it = _cache.find(key);</div>
<div class="line">        <span class="keywordflow">if</span> (it != _cache.end())</div>
<div class="line">        {</div>
<div class="line">            value = it-&gt;second;</div>
<div class="line">            _cache.erase(it);</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::mutex _cache_lock;</div>
<div class="line">    std::map&lt;std::string, std::string, std::less&lt;&gt;&gt; _cache;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>HTTPSCacheSession : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html">CppServer::HTTP::HTTPSSession</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using</span> <a name="a1"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9434ccac5f3ff32b3d7a3363eecd3e9a">CppServer::HTTP::HTTPSSession::HTTPSSession</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a name="a2"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aa6779440f69004e199d95b20c46182da">onReceivedRequest</a>(<span class="keyword">const</span> <a name="_a3"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html">CppServer::HTTP::HTTPRequest</a>&amp; request)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// Show HTTP request content</span></div>
<div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; request;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Process HTTP request methods</span></div>
<div class="line">        <span class="keywordflow">if</span> (request.<a name="a4"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>() == <span class="stringliteral">&quot;HEAD&quot;</span>)</div>
<div class="line">            <a name="a5"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a name="a6"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeHeadResponse());</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>() == <span class="stringliteral">&quot;GET&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            std::string key(request.<a name="a7"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#af0ab795ece4f2eba9efbbc42264eae4a">url</a>());</div>
<div class="line">            std::string value;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Decode the key value</span></div>
<div class="line">            key = CppCommon::Encoding::URLDecode(key);</div>
<div class="line">            CppCommon::StringUtils::ReplaceFirst(key, <span class="stringliteral">&quot;/api/cache&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">            CppCommon::StringUtils::ReplaceFirst(key, <span class="stringliteral">&quot;?key=&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (key.empty())</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Response with all cache values</span></div>
<div class="line">                <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeGetResponse(Cache::GetInstance().GetAllCache(), <span class="stringliteral">&quot;application/json; charset=UTF-8&quot;</span>));</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Get the cache value by the given key</span></div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Cache::GetInstance().GetCacheValue(key, value))</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Response with the cache value</span></div>
<div class="line">                <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeGetResponse(value));</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeErrorResponse(404, <span class="stringliteral">&quot;Required cache value was not found for the key: &quot;</span> + key));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>() == <span class="stringliteral">&quot;POST&quot;</span>) || (request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>() == <span class="stringliteral">&quot;PUT&quot;</span>))</div>
<div class="line">        {</div>
<div class="line">            std::string key(request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#af0ab795ece4f2eba9efbbc42264eae4a">url</a>());</div>
<div class="line">            std::string value(request.<a name="a8"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#af970b5ddefee972a44c3169cda8b9a1c">body</a>());</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Decode the key value</span></div>
<div class="line">            key = CppCommon::Encoding::URLDecode(key);</div>
<div class="line">            CppCommon::StringUtils::ReplaceFirst(key, <span class="stringliteral">&quot;/api/cache&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">            CppCommon::StringUtils::ReplaceFirst(key, <span class="stringliteral">&quot;?key=&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Put the cache value</span></div>
<div class="line">            Cache::GetInstance().PutCacheValue(key, value);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Response with the cache value</span></div>
<div class="line">            <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeOKResponse());</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>() == <span class="stringliteral">&quot;DELETE&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            std::string key(request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#af0ab795ece4f2eba9efbbc42264eae4a">url</a>());</div>
<div class="line">            std::string value;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Decode the key value</span></div>
<div class="line">            key = CppCommon::Encoding::URLDecode(key);</div>
<div class="line">            CppCommon::StringUtils::ReplaceFirst(key, <span class="stringliteral">&quot;/api/cache&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">            CppCommon::StringUtils::ReplaceFirst(key, <span class="stringliteral">&quot;?key=&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Delete the cache value</span></div>
<div class="line">            <span class="keywordflow">if</span> (Cache::GetInstance().DeleteCacheValue(key, value))</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Response with the cache value</span></div>
<div class="line">                <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeGetResponse(value));</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeErrorResponse(404, <span class="stringliteral">&quot;Deleted cache value was not found for the key: &quot;</span> + key));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>() == <span class="stringliteral">&quot;OPTIONS&quot;</span>)</div>
<div class="line">            <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeOptionsResponse());</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>() == <span class="stringliteral">&quot;TRACE&quot;</span>)</div>
<div class="line">            <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeTraceResponse(request.<a name="a9"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#a1532c75519199839fb2de65635843d6a">cache</a>()));</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">SendResponseAsync</a>(<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">response</a>().MakeErrorResponse(<span class="stringliteral">&quot;Unsupported HTTP method: &quot;</span> + std::string(request.<a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">method</a>())));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a10"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9e25e91ae0eccdb5a08d3d23c591891b">onReceivedRequestError</a>(<span class="keyword">const</span> <a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html">CppServer::HTTP::HTTPRequest</a>&amp; request, <span class="keyword">const</span> std::string&amp; error)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Request error: &quot;</span> &lt;&lt; error &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a name="a11"></a><a class="code" href="class_cpp_server_1_1_asio_1_1_s_s_l_session.html#ad221c1f648cbb82efb5b1b7ef7af0029">onError</a>(<span class="keywordtype">int</span> error, <span class="keyword">const</span> std::string&amp; category, <span class="keyword">const</span> std::string&amp; message)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;HTTPS session caught an error with code &quot;</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">&quot; and category &#39;&quot;</span> &lt;&lt; category &lt;&lt; <span class="stringliteral">&quot;&#39;: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>HTTPSCacheServer : <span class="keyword">public</span> <a name="_a12"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server.html">CppServer::HTTP::HTTPSServer</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using</span> <a name="a13"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server.html#af71fdedecc02142345c2d2f936559a1b">CppServer::HTTP::HTTPSServer::HTTPSServer</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    std::shared_ptr&lt;CppServer::Asio::SSLSession&gt; <a name="a14"></a><a class="code" href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server.html#a97bb62d38024fc6c819eb82bb5c28c2d">CreateSession</a>(<span class="keyword">const</span> std::shared_ptr&lt;CppServer::Asio::SSLServer&gt;&amp; server)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="keywordflow">return</span> std::make_shared&lt;HTTPSCacheSession&gt;(std::dynamic_pointer_cast&lt;CppServer::HTTP::HTTPSServer&gt;(server));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keywordtype">void</span> <a name="a15"></a><a class="code" href="class_cpp_server_1_1_asio_1_1_s_s_l_server.html#aafde0b3a3a6d3414e6e0f63c6088780a">onError</a>(<span class="keywordtype">int</span> error, <span class="keyword">const</span> std::string&amp; category, <span class="keyword">const</span> std::string&amp; message)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;HTTPS server caught an error with code &quot;</span> &lt;&lt; error &lt;&lt; <span class="stringliteral">&quot; and category &#39;&quot;</span> &lt;&lt; category &lt;&lt; <span class="stringliteral">&quot;&#39;: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// HTTPS server port</span></div>
<div class="line">    <span class="keywordtype">int</span> port = 8443;</div>
<div class="line">    <span class="keywordflow">if</span> (argc &gt; 1)</div>
<div class="line">        port = std::atoi(argv[1]);</div>
<div class="line">    <span class="comment">// HTTPS server content path</span></div>
<div class="line">    std::string www = <span class="stringliteral">&quot;../www/api&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (argc &gt; 2)</div>
<div class="line">        www = argv[2];</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;HTTPS server port: &quot;</span> &lt;&lt; port &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;HTTPS server static content path: &quot;</span> &lt;&lt; www &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;HTTPS server website: &quot;</span> &lt;&lt; <span class="stringliteral">&quot;https://localhost:&quot;</span> &lt;&lt; port &lt;&lt; <span class="stringliteral">&quot;/api/index.html&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a new Asio service</span></div>
<div class="line">    <span class="keyword">auto</span> service = std::make_shared&lt;AsioService&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start the Asio service</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Asio service starting...&quot;</span>;</div>
<div class="line">    service-&gt;Start();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Done!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create and prepare a new SSL server context</span></div>
<div class="line">    <span class="keyword">auto</span> context = std::make_shared&lt;CppServer::Asio::SSLContext&gt;(asio::ssl::context::tlsv13);</div>
<div class="line">    context-&gt;set_password_callback([](<span class="keywordtype">size_t</span> max_length, asio::ssl::context::password_purpose purpose) -&gt; std::string { <span class="keywordflow">return</span> <span class="stringliteral">&quot;qwerty&quot;</span>; });</div>
<div class="line">    context-&gt;use_certificate_chain_file(<span class="stringliteral">&quot;../tools/certificates/server.pem&quot;</span>);</div>
<div class="line">    context-&gt;use_private_key_file(<span class="stringliteral">&quot;../tools/certificates/server.pem&quot;</span>, asio::ssl::context::pem);</div>
<div class="line">    context-&gt;use_tmp_dh_file(<span class="stringliteral">&quot;../tools/certificates/dh4096.pem&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a new HTTPS server</span></div>
<div class="line">    <span class="keyword">auto</span> server = std::make_shared&lt;HTTPSCacheServer&gt;(service, context, port);</div>
<div class="line">    server-&gt;AddStaticContent(www, <span class="stringliteral">&quot;/api&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Start the server</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Server starting...&quot;</span>;</div>
<div class="line">    server-&gt;Start();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Done!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Press Enter to stop the server or &#39;!&#39; to restart the server...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Perform text input</span></div>
<div class="line">    std::string line;</div>
<div class="line">    <span class="keywordflow">while</span> (getline(std::cin, line))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (line.empty())</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Restart the server</span></div>
<div class="line">        <span class="keywordflow">if</span> (line == <span class="stringliteral">&quot;!&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Server restarting...&quot;</span>;</div>
<div class="line">            server-&gt;Restart();</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Done!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Stop the server</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Server stopping...&quot;</span>;</div>
<div class="line">    server-&gt;Stop();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Done!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Stop the Asio service</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Asio service stopping...&quot;</span>;</div>
<div class="line">    service-&gt;Stop();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Done!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclass_cpp_server_1_1_asio_1_1_s_s_l_server_html_aafde0b3a3a6d3414e6e0f63c6088780a"><div class="ttname"><a href="class_cpp_server_1_1_asio_1_1_s_s_l_server.html#aafde0b3a3a6d3414e6e0f63c6088780a">CppServer::Asio::SSLServer::onError</a></div><div class="ttdeci">virtual void onError(int error, const std::string &amp;category, const std::string &amp;message)</div><div class="ttdoc">Handle error notification.</div><div class="ttdef"><b>Definition:</b> <a href="ssl__server_8h_source.html#l00218">ssl_server.h:218</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_asio_1_1_s_s_l_session_html_ad221c1f648cbb82efb5b1b7ef7af0029"><div class="ttname"><a href="class_cpp_server_1_1_asio_1_1_s_s_l_session.html#ad221c1f648cbb82efb5b1b7ef7af0029">CppServer::Asio::SSLSession::onError</a></div><div class="ttdeci">virtual void onError(int error, const std::string &amp;category, const std::string &amp;message)</div><div class="ttdoc">Handle error notification.</div><div class="ttdef"><b>Definition:</b> <a href="ssl__session_8h_source.html#l00238">ssl_session.h:238</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request_html"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html">CppServer::HTTP::HTTPRequest</a></div><div class="ttdoc">HTTP request.</div><div class="ttdef"><b>Definition:</b> <a href="http__request_8h_source.html#l00030">http_request.h:31</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request_html_a1532c75519199839fb2de65635843d6a"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#a1532c75519199839fb2de65635843d6a">CppServer::HTTP::HTTPRequest::cache</a></div><div class="ttdeci">const std::string &amp; cache() const noexcept</div><div class="ttdoc">Get the HTTP request cache content.</div><div class="ttdef"><b>Definition:</b> <a href="http__request_8h_source.html#l00077">http_request.h:77</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request_html_ace1a6429fccea0c3e8fe2d291ea33538"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#ace1a6429fccea0c3e8fe2d291ea33538">CppServer::HTTP::HTTPRequest::method</a></div><div class="ttdeci">std::string_view method() const noexcept</div><div class="ttdoc">Get the HTTP request method.</div><div class="ttdef"><b>Definition:</b> <a href="http__request_8h_source.html#l00058">http_request.h:58</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request_html_af0ab795ece4f2eba9efbbc42264eae4a"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#af0ab795ece4f2eba9efbbc42264eae4a">CppServer::HTTP::HTTPRequest::url</a></div><div class="ttdeci">std::string_view url() const noexcept</div><div class="ttdoc">Get the HTTP request URL.</div><div class="ttdef"><b>Definition:</b> <a href="http__request_8h_source.html#l00060">http_request.h:60</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request_html_af970b5ddefee972a44c3169cda8b9a1c"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_request.html#af970b5ddefee972a44c3169cda8b9a1c">CppServer::HTTP::HTTPRequest::body</a></div><div class="ttdeci">std::string_view body() const noexcept</div><div class="ttdoc">Get the HTTP request body.</div><div class="ttdef"><b>Definition:</b> <a href="http__request_8h_source.html#l00072">http_request.h:72</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server_html"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server.html">CppServer::HTTP::HTTPSServer</a></div><div class="ttdoc">HTTPS server.</div><div class="ttdef"><b>Definition:</b> <a href="https__server_8h_source.html#l00029">https_server.h:30</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server_html_a97bb62d38024fc6c819eb82bb5c28c2d"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server.html#a97bb62d38024fc6c819eb82bb5c28c2d">CppServer::HTTP::HTTPSServer::CreateSession</a></div><div class="ttdeci">std::shared_ptr&lt; Asio::SSLSession &gt; CreateSession(const std::shared_ptr&lt; Asio::SSLServer &gt; &amp;server) override</div><div class="ttdef"><b>Definition:</b> <a href="https__server_8h_source.html#l00064">https_server.h:64</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server_html_af71fdedecc02142345c2d2f936559a1b"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_server.html#af71fdedecc02142345c2d2f936559a1b">CppServer::HTTP::HTTPSServer::HTTPSServer</a></div><div class="ttdeci">HTTPSServer(const HTTPSServer &amp;)=delete</div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session_html"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html">CppServer::HTTP::HTTPSSession</a></div><div class="ttdoc">HTTPS session.</div><div class="ttdef"><b>Definition:</b> <a href="https__session_8h_source.html#l00029">https_session.h:30</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session_html_a9434ccac5f3ff32b3d7a3363eecd3e9a"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9434ccac5f3ff32b3d7a3363eecd3e9a">CppServer::HTTP::HTTPSSession::HTTPSSession</a></div><div class="ttdeci">HTTPSSession(const std::shared_ptr&lt; HTTPSServer &gt; &amp;server)</div><div class="ttdef"><b>Definition:</b> <a href="https__session_8cpp_source.html#l00015">https_session.cpp:15</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session_html_a9e25e91ae0eccdb5a08d3d23c591891b"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9e25e91ae0eccdb5a08d3d23c591891b">CppServer::HTTP::HTTPSSession::onReceivedRequestError</a></div><div class="ttdeci">virtual void onReceivedRequestError(const HTTPRequest &amp;request, const std::string &amp;error)</div><div class="ttdoc">Handle HTTP request error notification.</div><div class="ttdef"><b>Definition:</b> <a href="https__session_8h_source.html#l00173">https_session.h:173</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session_html_a9fff46bfbccd4bae940703e53563ae5d"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#a9fff46bfbccd4bae940703e53563ae5d">CppServer::HTTP::HTTPSSession::response</a></div><div class="ttdeci">HTTPResponse &amp; response() noexcept</div><div class="ttdoc">Get the HTTP response.</div><div class="ttdef"><b>Definition:</b> <a href="https__session_8h_source.html#l00045">https_session.h:45</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session_html_aa6779440f69004e199d95b20c46182da"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aa6779440f69004e199d95b20c46182da">CppServer::HTTP::HTTPSSession::onReceivedRequest</a></div><div class="ttdeci">virtual void onReceivedRequest(const HTTPRequest &amp;request)</div><div class="ttdoc">Handle HTTP request received notification.</div><div class="ttdef"><b>Definition:</b> <a href="https__session_8h_source.html#l00150">https_session.h:150</a></div></div>
<div class="ttc" id="aclass_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session_html_aaeb6a91a94320fa7259525450a6bd13b"><div class="ttname"><a href="class_cpp_server_1_1_h_t_t_p_1_1_h_t_t_p_s_session.html#aaeb6a91a94320fa7259525450a6bd13b">CppServer::HTTP::HTTPSSession::SendResponseAsync</a></div><div class="ttdeci">bool SendResponseAsync()</div><div class="ttdoc">Send the current HTTP response (asynchronous)</div><div class="ttdef"><b>Definition:</b> <a href="https__session_8h_source.html#l00108">https_session.h:108</a></div></div>
<div class="ttc" id="ahttps__server_8h_html"><div class="ttname"><a href="https__server_8h.html">https_server.h</a></div><div class="ttdoc">HTTPS server definition.</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
